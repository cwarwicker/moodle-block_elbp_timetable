<?php if(!defined('ELBP')) exit; ?>

<h2><?php echo $string['dataimport'] ?></h2>

<div class="elbp_warning_box">
    <?php echo get_string('dataimport:warning', 'block_elbp_timetable'); ?>
</div>

<p><?php echo $string['attendance:dataimport:info'] ?></p>

<p>
<?php if ($importFile !== false): ?>
    <a href="<?php echo $CFG->wwwroot ?>/blocks/elbp/download.php?f=<?php echo $importFile ?>"><?php echo $string['csvtemplate'] ?></a>
<?php else: ?>
    [[<?php echo $string['filenotfound'] ?>]]
<?php endif; ?>
&nbsp;&nbsp;&nbsp;&nbsp;
<?php if ($exampleFile !== false): ?>
    <a href="<?php echo $CFG->wwwroot ?>/blocks/elbp/download.php?f=<?php echo $exampleFile ?>"><?php echo $string['csvexample'] ?></a>
<?php else: ?>
    [[<?php echo $string['filenotfound'] ?>]]
<?php endif; ?>

&nbsp;&nbsp;&nbsp;&nbsp;

<a href="<?php echo $CFG->wwwroot ?><?php echo $TT->getPath() ?>config.php?view=data&reload=1"><img style="vertical-align:top;" src="<?php echo $OUTPUT->image_url('t/reload'); ?>" title="<?php echo $string['reloadcsvs'] ?>" /></a>

</p>

<br>

<form action="" method="post" enctype="multipart/form-data">

    <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />
    <input type="file" name="file" /> <input type="submit" name="submit_import" value="<?php echo $string['import'] ?>" />
    
</form>

<?php if (isset($MSGS['result'])): ?>
    
    <?php if ($MSGS['result']['success'] === true): ?>
        <div class='process-output-success'>
            <?php echo $MSGS['result']['output'] ?>
        </div>
    <?php else: ?>
        <div class='process-output-error'>
            <?php echo $MSGS['result']['error'] ?>
        </div>
    <?php endif; ?>

<?php endif; ?>

<br><br>

<h2><?php echo $string['datasettings'] ?></h2>

<p><?php echo get_string('datasettings:info', 'block_elbp_timetable') ?></p>

<form action="" method="post">

    <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />

    <small><strong><?php echo $string['users']; ?></strong> - <?php echo $string['dataimport:users'] ?></small><br>
    <input type='radio' name='import_create_user_if_not_exists' value='1' <?php echo ($TT->getSetting('import_create_user_if_not_exists') == 1 ) ? 'checked' : '' ?> /> <?php echo $string['enable'] ?> &nbsp;
    <input type='radio' name='import_create_user_if_not_exists' value='0' <?php echo ($TT->getSetting('import_create_user_if_not_exists') != 1 ) ? 'checked' : '' ?> /> <?php echo $string['disable'] ?> &nbsp;
    <br><br>
    
    <small><strong><?php echo $string['courses']; ?></strong> - <?php echo $string['dataimport:courses'] ?></small><br>
    <input type='radio' name='import_create_course_if_not_exists' value='1' <?php echo ($TT->getSetting('import_create_course_if_not_exists') == 1 ) ? 'checked' : '' ?> /> <?php echo $string['enable'] ?> &nbsp;
    <input type='radio' name='import_create_course_if_not_exists' value='0' <?php echo ($TT->getSetting('import_create_course_if_not_exists') != 1 ) ? 'checked' : '' ?> /> <?php echo $string['disable'] ?> &nbsp;
    <br><br>
    
    <small><strong><?php echo $string['coursefield']; ?></strong> - <?php echo $string['dataimport:coursefield'] ?></small><br>
    <select name='import_course_field'>
        <option value='shortname' <?php echo ($TT->getSetting('import_course_field') == 'shortname' ) ? 'selected' : '' ?> >shortname</option>
        <option value='idnumber' <?php echo ($TT->getSetting('import_course_field') == 'idnumber' ) ? 'selected' : '' ?> >idnumber</option>
    </select>
    <br><br>
    
    <small><strong><?php echo $string['userfield']; ?></strong> - <?php echo $string['dataimport:userfield'] ?></small><br>
    <select name='import_user_field'>
        <option value='username' <?php echo ($TT->getSetting('import_user_field') == 'username' ) ? 'selected' : '' ?> >username</option>
        <option value='idnumber' <?php echo ($TT->getSetting('import_user_field') == 'idnumber' ) ? 'selected' : '' ?> >idnumber</option>
    </select>
    <br><br>
    
    <input type="submit" name="submitconfig" value="<?php echo $string['save'] ?>" />
    
</form>
    